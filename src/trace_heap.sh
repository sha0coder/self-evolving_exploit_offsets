#!/bin/bash

cp free.gdb tmp.gdb
echo "r  " >> tmp.gdb


env - gdb -q < tmp.gdb | grep '>>>' >log 2>&1

user_args=$(cat log |grep 'user_args addr' | awk '{ print $4 }')
ni_name=$(cat log|grep 'ni->name' |awk '{ print $4}' | head -1 )
ni_name_less=$(cat log|grep 'ni->name' |awk '{ print $4}' | head -1 | perl -e 'print substr(<>,0,7);')
#grep $user_args log

if [ -z $user_args ]
then
        echo "-999999999999"
        exit
fi

if [ -z $ni_name ]
then
        echo "-999999999999"
        exit
fi

#grep $ni_name_less log | grep -v utf8 | sort -u
#echo ------
#grep $user_args log | sort -u
python3 -c "print('%d' % ($ni_name-$user_args))"
rm tmp.gdb

